{% extends "base.html" %}
{% block content %}
    <link rel="stylesheet" href="/static/css/analytics.css">

    <div class="container">
        <h1>Аналитика</h1>
    </div>

    <div class="container">
        <h2>Источник: данные АО "Астана РЭК"</h2>
    </div>

    <div class="container">
        <div class="white-box graph" style="margin-right: 20px;">
            <canvas id="myChart"></canvas>
        </div>

        <div class="white-box graph">
            <canvas id="myChart2"></canvas>
        </div>
    </div>

    <div class="container">
        <div class="white-box" style="width: 1000px;">
            <canvas id="myChart3" class="on-observe3"></canvas>
        </div>
    </div>

    <div class="container">
        <div class="white-box graph" style="margin-right: 20px;">
            <canvas id="myChart4" class="on-observe4"></canvas>
        </div>

        <div class="white-box graph">
            <canvas id="myChart5" class="on-observe5"></canvas>
        </div>
    </div>

    <script src="/static/script/chart.min.js"></script>
    <script src="/static/script/chartjs-plugin-datalabels.min.js"></script>
    <script>
        const data = {
            labels: ['2016 г', '2017 г', '2018 г', '2019 г', '2020 г'],
            datasets: [
                {
                    label: 'Передача электроэнергии, млн. кВт*ч',
                    data: [3033.4, 3203, 3396, 3433.8, 3352.2],
                    backgroundColor: '#39449b',
                    borderColor: '#39449b',
                    order: 1,
                    yAxisID: 'y1'
                },
                {
                    label: 'Доля потерь электроэнергии, %',
                    data: [13.7, 12.8, 11.8, 11.0, 12.1],
                    type: 'line',
                    backgroundColor: '#ff5f5f',
                    borderColor: '#ff5f5f',
                    order: 0,
                    yAxisID: 'y2'
                }
            ]
        };

        const config = {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top'
                    },
                    title: {
                        display: true,
                        text: 'Показатели основной деятельности'
                    }
                },
                scales: {
                    y1: {
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Передача эдектроэнергии, млн. кВт*ч'
                        }
                    },
                    y2: {
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Доля потерь электроэнергии, %'
                        }
                    }
                }
            }
        };

        const ctx = document.getElementById('myChart').getContext('2d');
        const myChart = new Chart(ctx, config);
    </script>
    <script>
        const data2 = {
            labels: ['2016 г', '2017 г', '2018 г', '2019 г', '2020 г'],
            datasets: [
                {
                    label: 'КЛ-220кВ',
                    data: [2.234, 2.234, 2.234, 12.3, 12.3],
                    backgroundColor: '#39449b',
                    borderColor: '#39449b',
                    yAxisID: 'y1'
                },
                {
                    label: 'КЛ-110кВ',
                    data: [95.73, 101.684, 134.848, 140.552, 168.524],
                    backgroundColor: '#ff5f5f',
                    borderColor: '#ff5f5f',
                    yAxisID: 'y2'
                },
                {
                    label: 'КЛ-20кВ',
                    data: [0, 228.891, 299.017, 208.981, 310.956],
                    backgroundColor: '#399b60',
                    borderColor: '#399B60FF',
                    yAxisID: 'y3'
                },
                {
                    label: 'КЛ-10кВ',
                    data: [1433.78, 1684.4106, 1804.783, 1866.749, 2140.219],
                    backgroundColor: '#9b9339',
                    borderColor: '#9B9339FF',
                    yAxisID: 'y4'
                },
                {
                    label: 'КЛ-6кВ',
                    data: [0, 19.065, 19.065, 19.065, 19.065],
                    backgroundColor: '#74399b',
                    borderColor: '#74399BFF',
                    yAxisID: 'y5'
                },
                {
                    label: 'КЛ-0,4кВ',
                    data: [909.31, 942.7247, 993.797, 999.126, 1111.56],
                    backgroundColor: '#9b6539',
                    borderColor: '#9B6539FF',
                    yAxisID: 'y6'
                },
                {
                    label: 'ВЛ-220кВ',
                    data: [124, 124.588, 124.588, 143.436, 143.436],
                    backgroundColor: '#399b9b',
                    borderColor: '#399B9BFF',
                    yAxisID: 'y7'
                },
                {
                    label: 'ВЛ-110кВ',
                    data: [148.9, 148.633, 149.569, 144.953, 202.255],
                    backgroundColor: '#839b39',
                    borderColor: '#839B39FF',
                    yAxisID: 'y8'
                },
                {
                    label: 'ВЛ-10кВ',
                    data: [326.58, 332.569, 329.31, 326.09, 350.04],
                    backgroundColor: '#b4005a',
                    borderColor: '#B4005AFF',
                    yAxisID: 'y9'
                },
                {
                    label: 'ВЛ-0,4кВ',
                    data: [453, 442.495, 437.774, 442.679, 508.734],
                    backgroundColor: '#f53c3c',
                    borderColor: '#F53C3CFF',
                    yAxisID: 'y10'
                }
            ]
        };

        const config2 = {
            type: 'bar',
            data: data2,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top'
                    },
                    title: {
                        display: true,
                        text: 'Динамика развития электросетевого оборудования'
                    }
                },
                scales: {
                    y1: {
                        position: 'left',
                        title: {
                            display: true,
                            text: 'протяженность ВЛ и КЛ, км'
                        },
                        suggestedMin: 0,
                        suggestedMax: 5000
                    },
                    y2: {
                        display: false
                    },
                    y3: {
                        display: false
                    },
                    y4: {
                        display: false
                    },
                    y5: {
                        display: false
                    },
                    y6: {
                        display: false
                    },
                    y7: {
                        display: false
                    },
                    y8: {
                        display: false
                    },
                    y9: {
                        display: false
                    },
                    y10: {
                        display: false
                    }
                }
            }
        };

        const ctx2 = document.getElementById('myChart2').getContext('2d');
        const myChart2 = new Chart(ctx2, config2);
    </script>
    <script>
        function make_graph3() {
            let colors = [];
            for (let i = 0; i < 20; ++i) {
                if (i === 0) {
                    colors.push('#ffc000');
                } else {
                    colors.push('#39449b');
                }
            }

            const data3 = {
                labels: ['Астана РЭК', 'Атырау-Жарык', 'Онтустик Жарык Транзит РЭК', 'Кокшетау-Энерго', 'Павлодарская РЭК',
                    'Жезказганская РЭК', 'Алатау-Жарык (АЖК)', 'Акмолинская РЭК', 'Энергосистема', 'Мангистауская РЭК', 'ТАТЭК',
                    'Жамбылские электрические сети', 'Кызылординская РЭК', 'Караганды Жарык', 'Северо-Казахстанская РЭК',
                    'Карагандинская РЭК', 'ВКО АО "Объединенная ЭнергоСервисная Комп."', 'Запано-Казахстанская РЭК',
                    'Межрегионэнерготранзит'],
                datasets: [
                    {
                        label: 'Износ основных фондов, %',
                        data: [29, 40, 49, 57.5, 58.8, 59.7, 65.5, 66, 66, 66.2, 66.9, 68.7, 70, 70.2, 76.6, 80, 81, 81.1,
                            85],
                        backgroundColor: colors,
                        borderColor: colors,
                    }
                ]
            };

            const config3 = {
                type: 'bar',
                data: data3,
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Износ основных фондов, %'
                        }
                    },
                    suggestedMin: 0,
                    suggestedMax: 90
                }
            };
            const ctx3 = document.getElementById('myChart3').getContext('2d');
            const myChart3 = new Chart(ctx3, config3);
        }

        function onEntry(entry) {
            entry.forEach(change => {
                if (change.isIntersecting) {
                    if (Chart.getChart('myChart3') === undefined) {
                        make_graph3();
                    }
                }
            });
        }
        let options = { threshold: [0.5] };
        let observer = new IntersectionObserver(onEntry, options);
        observer.observe(document.querySelector('.on-observe3'));
    </script>
    <script>
        function make_graph4() {
            const data4 = {
                labels: ['2017 г', '2018 г', '2019 г', '2020 г'],
                datasets: [
                    {
                        label: 'SAIDI продолжительнось перерывов в электроснабжении, часов в год',
                        data: [0.97, 1.2, 0.7, 0.4],
                        backgroundColor: '#39449b',
                        borderColor: '#39449b',
                    }
                ]
            };

            const config4 = {
                type: 'bar',
                data: data4,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Индексы надежности электроснабжения'
                        }
                    }
                }
            };

            const ctx4 = document.getElementById('myChart4').getContext('2d');
            const myChart4 = new Chart(ctx4, config4);
        }

        function onEntry2(entry) {
            entry.forEach(change => {
                if (change.isIntersecting) {
                    if (Chart.getChart('myChart4') === undefined) {
                        make_graph4();
                    }
                }
            });
        }
        let options2 = { threshold: [0.5] };
        let observer2 = new IntersectionObserver(onEntry2, options2);
        observer2.observe(document.querySelector('.on-observe4'));
    </script>
    <script>
        function make_graph5() {
            const data5 = {
                labels: ['2017 г', '2018 г', '2019 г', '2020 г'],
                datasets: [
                    {
                        label: 'SAIFI частота перерывов в электроснабжении, раз в год',
                        data: [0.5, 0.7, 0.6, 0.3],
                        backgroundColor: '#39449b',
                        borderColor: '#39449b',
                    }
                ]
            };

            const config5 = {
                type: 'bar',
                data: data5,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Индексы надежности электроснабжения'
                        }
                    }
                }
            };

            const ctx5 = document.getElementById('myChart5').getContext('2d');
            const myChart5 = new Chart(ctx5, config5);
        }

        function onEntry3(entry) {
            entry.forEach(change => {
                if (change.isIntersecting) {
                    if (Chart.getChart('myChart5') === undefined) {
                        make_graph5();
                    }
                }
            });
        }
        let options3 = { threshold: [0.5] };
        let observer3 = new IntersectionObserver(onEntry3, options3);
        observer3.observe(document.querySelector('.on-observe5'));
    </script>
{% endblock %}